<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>parks/te2/te2.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ConfigBase.html">ConfigBase</a></li><li><a href="Database.html">Database</a><ul class='methods'><li data-type='method'><a href="Database.html#_getEntities">_getEntities</a></li><li data-type='method'><a href="Database.html#_init">_init</a></li><li data-type='method'><a href="Database.html#findEntity">findEntity</a></li><li data-type='method'><a href="Database.html#getEntities">getEntities</a></li><li data-type='method'><a href="Database.html#getEntitiyById">getEntitiyById</a></li><li data-type='method'><a href="Database.html#init">init</a></li><li data-type='method'><a href="Database.html#log">log</a></li><li data-type='method'><a href="Database.html#.get">get</a></li></ul></li><li><a href="DatabaseEuropaPark.html">DatabaseEuropaPark</a><ul class='methods'><li data-type='method'><a href="DatabaseEuropaPark.html#_getEntities">_getEntities</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#_init">_init</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getCalendar">getCalendar</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getConfig">getConfig</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getFirebaseID">getFirebaseID</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getLiveCalendar">getLiveCalendar</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getParkData">getParkData</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getShowTimes">getShowTimes</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getToken">getToken</a></li><li data-type='method'><a href="DatabaseEuropaPark.html#getWaitingTimes">getWaitingTimes</a></li></ul></li><li><a href="DatabaseWDW.html">DatabaseWDW</a><ul class='methods'><li data-type='method'><a href="DatabaseWDW.html#_getEntities">_getEntities</a></li></ul></li><li><a href="Destination.html">Destination</a><ul class='methods'><li data-type='method'><a href="Destination.html#_clearFunctionCache">_clearFunctionCache</a></li><li data-type='method'><a href="Destination.html#_init">_init</a></li><li data-type='method'><a href="Destination.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="Destination.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="Destination.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="Destination.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="Destination.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="Destination.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="Destination.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="Destination.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="Destination.html#calculateTimezone">calculateTimezone</a></li><li data-type='method'><a href="Destination.html#forEachUpcomingDate">forEachUpcomingDate</a></li><li data-type='method'><a href="Destination.html#getAllEntities">getAllEntities</a></li><li data-type='method'><a href="Destination.html#getAndroidAPPVersion">getAndroidAPPVersion</a></li><li data-type='method'><a href="Destination.html#getAttractionEntities">getAttractionEntities</a></li><li data-type='method'><a href="Destination.html#getDestinationEntities">getDestinationEntities</a></li><li data-type='method'><a href="Destination.html#getDestinationEntity">getDestinationEntity</a></li><li data-type='method'><a href="Destination.html#getEntityFromId">getEntityFromId</a></li><li data-type='method'><a href="Destination.html#getEntityLiveData">getEntityLiveData</a></li><li data-type='method'><a href="Destination.html#getEntitySchedules">getEntitySchedules</a></li><li data-type='method'><a href="Destination.html#getLiveCache">getLiveCache</a></li><li data-type='method'><a href="Destination.html#getLiveHash">getLiveHash</a></li><li data-type='method'><a href="Destination.html#getParkEntities">getParkEntities</a></li><li data-type='method'><a href="Destination.html#getRestaurantEntities">getRestaurantEntities</a></li><li data-type='method'><a href="Destination.html#getShowEntities">getShowEntities</a></li><li data-type='method'><a href="Destination.html#getTimeNow">getTimeNow</a></li><li data-type='method'><a href="Destination.html#getTimeNowMoment">getTimeNowMoment</a></li><li data-type='method'><a href="Destination.html#init">init</a></li><li data-type='method'><a href="Destination.html#log">log</a></li><li data-type='method'><a href="Destination.html#setLiveCache">setLiveCache</a></li><li data-type='method'><a href="Destination.html#updateEntityLiveData">updateEntityLiveData</a></li></ul></li><li><a href="DisneyLiveResort.html">DisneyLiveResort</a><ul class='methods'><li data-type='method'><a href="DisneyLiveResort.html#_buildLiveDataObject">_buildLiveDataObject</a></li><li data-type='method'><a href="DisneyLiveResort.html#_fetchRestaurantMenu">_fetchRestaurantMenu</a></li><li data-type='method'><a href="DisneyLiveResort.html#_getSchedulesForDate">_getSchedulesForDate</a></li><li data-type='method'><a href="DisneyLiveResort.html#_init">_init</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="DisneyLiveResort.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="DisneyLiveResort.html#fetchVirtualQueueData">fetchVirtualQueueData</a></li><li data-type='method'><a href="DisneyLiveResort.html#getFacilityStatusChannelID">getFacilityStatusChannelID</a></li><li data-type='method'><a href="DisneyLiveResort.html#getRestaurantMenu">getRestaurantMenu</a></li><li data-type='method'><a href="DisneyLiveResort.html#initLiveStatusUpdates">initLiveStatusUpdates</a></li><li data-type='method'><a href="DisneyLiveResort.html#sanitizeEntityName">sanitizeEntityName</a></li></ul></li><li><a href="DisneylandParis.html">DisneylandParis</a><ul class='methods'><li data-type='method'><a href="DisneylandParis.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="DisneylandParis.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="DisneylandParis.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="DisneylandParis.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="DisneylandParis.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="DisneylandParis.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="DisneylandParis.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="DisneylandParis.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="DisneylandParis.html#fetchPremierAccessData">fetchPremierAccessData</a></li><li data-type='method'><a href="DisneylandParis.html#fetchResortScheduleForDate">fetchResortScheduleForDate</a></li><li data-type='method'><a href="DisneylandParis.html#fetchVirtualQueueData">fetchVirtualQueueData</a></li><li data-type='method'><a href="DisneylandParis.html#fetchWaitData">fetchWaitData</a></li><li data-type='method'><a href="DisneylandParis.html#getAuthApiKey">getAuthApiKey</a></li><li data-type='method'><a href="DisneylandParis.html#getAuthToken">getAuthToken</a></li><li data-type='method'><a href="DisneylandParis.html#getPOIData">getPOIData</a></li><li data-type='method'><a href="DisneylandParis.html#getRefreshToken">getRefreshToken</a></li><li data-type='method'><a href="DisneylandParis.html#refreshAuthToken">refreshAuthToken</a></li></ul></li><li><a href="DisneylandResort.html">DisneylandResort</a></li><li><a href="Efteling.html">Efteling</a><ul class='methods'><li data-type='method'><a href="Efteling.html#_fetchPOIData">_fetchPOIData</a></li><li data-type='method'><a href="Efteling.html#_getRestaurantOperatingHoursForDate">_getRestaurantOperatingHoursForDate</a></li><li data-type='method'><a href="Efteling.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="Efteling.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="Efteling.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="Efteling.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="Efteling.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="Efteling.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="Efteling.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="Efteling.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="Efteling.html#getCalendarMonth">getCalendarMonth</a></li><li data-type='method'><a href="Efteling.html#getPOIData">getPOIData</a></li><li data-type='method'><a href="Efteling.html#getRestaurantOperatingHours">getRestaurantOperatingHours</a></li></ul></li><li><a href="Entity.html">Entity</a><ul class='methods'><li data-type='method'><a href="Entity.html#_postOfflineLoad">_postOfflineLoad</a></li><li data-type='method'><a href="Entity.html#ensureHasOfflineData">ensureHasOfflineData</a></li><li data-type='method'><a href="Entity.html#getTimeNow">getTimeNow</a></li><li data-type='method'><a href="Entity.html#getTimeNowMoment">getTimeNowMoment</a></li><li data-type='method'><a href="Entity.html#getUniqueID">getUniqueID</a></li><li data-type='method'><a href="Entity.html#injectForDomain">injectForDomain</a></li><li data-type='method'><a href="Entity.html#log">log</a></li><li data-type='method'><a href="Entity.html#registerOfflineFunction">registerOfflineFunction</a></li><li data-type='method'><a href="Entity.html#serialise">serialise</a></li></ul></li><li><a href="HarWriter.html">HarWriter</a><ul class='methods'><li data-type='method'><a href="HarWriter.html#createLogObject">createLogObject</a></li><li data-type='method'><a href="HarWriter.html#getProjectVersion">getProjectVersion</a></li><li data-type='method'><a href="HarWriter.html#recordEntry">recordEntry</a></li><li data-type='method'><a href="HarWriter.html#toJSON">toJSON</a></li><li data-type='method'><a href="HarWriter.html#write">write</a></li></ul></li><li><a href="HongKongDisneyland.html">HongKongDisneyland</a><ul class='methods'><li data-type='method'><a href="HongKongDisneyland.html#_fetchRestaurantMenu">_fetchRestaurantMenu</a></li></ul></li><li><a href="IndexedWDWDB.html">IndexedWDWDB</a><ul class='methods'><li data-type='method'><a href="IndexedWDWDB.html#_createIndex">_createIndex</a></li><li data-type='method'><a href="IndexedWDWDB.html#_createIndexes">_createIndexes</a></li><li data-type='method'><a href="IndexedWDWDB.html#_extractChannelLanguage">_extractChannelLanguage</a></li><li data-type='method'><a href="IndexedWDWDB.html#_extractEntityKeys">_extractEntityKeys</a></li><li data-type='method'><a href="IndexedWDWDB.html#_indexWDWDocument">_indexWDWDocument</a></li><li data-type='method'><a href="IndexedWDWDB.html#_initIndexes">_initIndexes</a></li><li data-type='method'><a href="IndexedWDWDB.html#_loadAndInit">_loadAndInit</a></li><li data-type='method'><a href="IndexedWDWDB.html#_removeFromArrayIndex">_removeFromArrayIndex</a></li><li data-type='method'><a href="IndexedWDWDB.html#_replicate">_replicate</a></li><li data-type='method'><a href="IndexedWDWDB.html#find">find</a></li><li data-type='method'><a href="IndexedWDWDB.html#getByChannel">getByChannel</a></li><li data-type='method'><a href="IndexedWDWDB.html#getDocChildren">getDocChildren</a></li><li data-type='method'><a href="IndexedWDWDB.html#getDocNameSearch">getDocNameSearch</a></li><li data-type='method'><a href="IndexedWDWDB.html#getDocsById">getDocsById</a></li><li data-type='method'><a href="IndexedWDWDB.html#getDumpFilename">getDumpFilename</a></li><li data-type='method'><a href="IndexedWDWDB.html#getEntity">getEntity</a></li><li data-type='method'><a href="IndexedWDWDB.html#getEntityIndex">getEntityIndex</a></li><li data-type='method'><a href="IndexedWDWDB.html#getEntityOne">getEntityOne</a></li><li data-type='method'><a href="IndexedWDWDB.html#getFacilityStatus">getFacilityStatus</a></li><li data-type='method'><a href="IndexedWDWDB.html#getIndex">getIndex</a></li><li data-type='method'><a href="IndexedWDWDB.html#init">init</a></li><li data-type='method'><a href="IndexedWDWDB.html#loadSnapshot">loadSnapshot</a></li><li data-type='method'><a href="IndexedWDWDB.html#saveSnapshot">saveSnapshot</a></li><li data-type='method'><a href="IndexedWDWDB.html#subscribeToChanges">subscribeToChanges</a></li><li data-type='method'><a href="IndexedWDWDB.html#subscribeToChannel">subscribeToChannel</a></li><li data-type='method'><a href="IndexedWDWDB.html#._pluginBulkDocs">_pluginBulkDocs</a></li><li data-type='method'><a href="IndexedWDWDB.html#.getDatabaseFilePath">getDatabaseFilePath</a></li></ul></li><li><a href="Park.html">Park</a><ul class='methods'><li data-type='method'><a href="Park.html#_buildAttractionObject">_buildAttractionObject</a></li><li data-type='method'><a href="Park.html#_checkDate">_checkDate</a></li><li data-type='method'><a href="Park.html#_dateRefresh">_dateRefresh</a></li><li data-type='method'><a href="Park.html#_findAttractionByID">_findAttractionByID</a></li><li data-type='method'><a href="Park.html#_getAttractionByIDInternal">_getAttractionByIDInternal</a></li><li data-type='method'><a href="Park.html#_getOperatingHoursForDate">_getOperatingHoursForDate</a></li><li data-type='method'><a href="Park.html#_getRestaurantOperatingHoursForDate">_getRestaurantOperatingHoursForDate</a></li><li data-type='method'><a href="Park.html#_init">_init</a></li><li data-type='method'><a href="Park.html#_postInit">_postInit</a></li><li data-type='method'><a href="Park.html#_postOfflineLoad">_postOfflineLoad</a></li><li data-type='method'><a href="Park.html#_runInit">_runInit</a></li><li data-type='method'><a href="Park.html#_runUpdate">_runUpdate</a></li><li data-type='method'><a href="Park.html#_update">_update</a></li><li data-type='method'><a href="Park.html#cacheAttractionObject">cacheAttractionObject</a></li><li data-type='method'><a href="Park.html#ensureReady">ensureReady</a></li><li data-type='method'><a href="Park.html#findAttractionByID">findAttractionByID</a></li><li data-type='method'><a href="Park.html#getActiveParkDate">getActiveParkDate</a></li><li data-type='method'><a href="Park.html#getActiveParkDateMoment">getActiveParkDateMoment</a></li><li data-type='method'><a href="Park.html#getAttractions">getAttractions</a></li><li data-type='method'><a href="Park.html#getCalendar">getCalendar</a></li><li data-type='method'><a href="Park.html#getCalendarForToday">getCalendarForToday</a></li><li data-type='method'><a href="Park.html#getCalendarForTomorrow">getCalendarForTomorrow</a></li><li data-type='method'><a href="Park.html#getNextClosingTime">getNextClosingTime</a></li><li data-type='method'><a href="Park.html#getNextOpeningTime">getNextOpeningTime</a></li><li data-type='method'><a href="Park.html#getNextOpeningTimeMomentDuration">getNextOpeningTimeMomentDuration</a></li><li data-type='method'><a href="Park.html#getOperatingHoursForDate">getOperatingHoursForDate</a></li><li data-type='method'><a href="Park.html#getParkUniqueID">getParkUniqueID</a></li><li data-type='method'><a href="Park.html#getRestaurantOperatingHoursForDate">getRestaurantOperatingHoursForDate</a></li><li data-type='method'><a href="Park.html#init">init</a></li><li data-type='method'><a href="Park.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="Park.html#removeAttractionTag">removeAttractionTag</a></li><li data-type='method'><a href="Park.html#setAttractionTag">setAttractionTag</a></li><li data-type='method'><a href="Park.html#shutdown">shutdown</a></li><li data-type='method'><a href="Park.html#toggleAttractionTag">toggleAttractionTag</a></li><li data-type='method'><a href="Park.html#update">update</a></li><li data-type='method'><a href="Park.html#updateAttractionQueue">updateAttractionQueue</a></li><li data-type='method'><a href="Park.html#updateAttractionState">updateAttractionState</a></li></ul></li><li><a href="PlopsalandDeutschland.html">PlopsalandDeutschland</a><ul class='methods'><li data-type='method'><a href="PlopsalandDeutschland.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#getEntertainmentProgram">getEntertainmentProgram</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#getParkHours">getParkHours</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#getPointsOfInterest">getPointsOfInterest</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#getWaitingTimes">getWaitingTimes</a></li><li data-type='method'><a href="PlopsalandDeutschland.html#imageToCoordinates">imageToCoordinates</a></li></ul></li><li><a href="ScopedCache.html">ScopedCache</a><ul class='methods'><li data-type='method'><a href="ScopedCache.html#_initCache">_initCache</a></li><li data-type='method'><a href="ScopedCache.html#blockOnPendingTransactions">blockOnPendingTransactions</a></li><li data-type='method'><a href="ScopedCache.html#generateScopedKey">generateScopedKey</a></li><li data-type='method'><a href="ScopedCache.html#get">get</a></li><li data-type='method'><a href="ScopedCache.html#getGlobal">getGlobal</a></li><li data-type='method'><a href="ScopedCache.html#getKeys">getKeys</a></li><li data-type='method'><a href="ScopedCache.html#initCache">initCache</a></li><li data-type='method'><a href="ScopedCache.html#runTransaction">runTransaction</a></li><li data-type='method'><a href="ScopedCache.html#set">set</a></li><li data-type='method'><a href="ScopedCache.html#setGlobal">setGlobal</a></li><li data-type='method'><a href="ScopedCache.html#wrap">wrap</a></li><li data-type='method'><a href="ScopedCache.html#wrapGlobal">wrapGlobal</a></li></ul></li><li><a href="ShanghaiDisneylandResort.html">ShanghaiDisneylandResort</a><ul class='methods'><li data-type='method'><a href="ShanghaiDisneylandResort.html#_buildAttractionObject">_buildAttractionObject</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_buildEntities">_buildEntities</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_dumpDB">_dumpDB</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_fetchWaitTimes">_fetchWaitTimes</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_init">_init</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_loadDB">_loadDB</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#_refreshAttractionData">_refreshAttractionData</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#extractEntityData">extractEntityData</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#getAccessToken">getAccessToken</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#getAllEntityKeys">getAllEntityKeys</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#getAttractionData">getAttractionData</a></li><li data-type='method'><a href="ShanghaiDisneylandResort.html#getEntity">getEntity</a></li></ul></li><li><a href="TE2Destination.html">TE2Destination</a><ul class='methods'><li data-type='method'><a href="TE2Destination.html#_buildPOIMap">_buildPOIMap</a></li><li data-type='method'><a href="TE2Destination.html#_buildShowEntityFromEvent">_buildShowEntityFromEvent</a></li><li data-type='method'><a href="TE2Destination.html#_fetchCategories">_fetchCategories</a></li><li data-type='method'><a href="TE2Destination.html#_fetchScheduleData">_fetchScheduleData</a></li><li data-type='method'><a href="TE2Destination.html#_findLocationForShowEntity">_findLocationForShowEntity</a></li><li data-type='method'><a href="TE2Destination.html#_getEventCalendarData">_getEventCalendarData</a></li><li data-type='method'><a href="TE2Destination.html#_getFilteredEntities">_getFilteredEntities</a></li><li data-type='method'><a href="TE2Destination.html#_getParsedCategories">_getParsedCategories</a></li><li data-type='method'><a href="TE2Destination.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="TE2Destination.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="TE2Destination.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="TE2Destination.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="TE2Destination.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="TE2Destination.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="TE2Destination.html#fetchEventCalendar">fetchEventCalendar</a></li><li data-type='method'><a href="TE2Destination.html#getAttractionTypes">getAttractionTypes</a></li><li data-type='method'><a href="TE2Destination.html#getDestinationData">getDestinationData</a></li><li data-type='method'><a href="TE2Destination.html#getDiningTypes">getDiningTypes</a></li><li data-type='method'><a href="TE2Destination.html#getPOIData">getPOIData</a></li><li data-type='method'><a href="TE2Destination.html#getPOIStatus">getPOIStatus</a></li><li data-type='method'><a href="TE2Destination.html#getShowTypes">getShowTypes</a></li></ul></li><li><a href="TokyoDisneyResort.html">TokyoDisneyResort</a><ul class='methods'><li data-type='method'><a href="TokyoDisneyResort.html#_buildAttractionObject">_buildAttractionObject</a></li><li data-type='method'><a href="TokyoDisneyResort.html#_fetchWaitTimes">_fetchWaitTimes</a></li><li data-type='method'><a href="TokyoDisneyResort.html#_getOperatingHoursForDate">_getOperatingHoursForDate</a></li><li data-type='method'><a href="TokyoDisneyResort.html#_getRestaurantOperatingHoursForDate">_getRestaurantOperatingHoursForDate</a></li><li data-type='method'><a href="TokyoDisneyResort.html#_update">_update</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildAttractionEntities">buildAttractionEntities</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildBaseEntityObject">buildBaseEntityObject</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildDestinationEntity">buildDestinationEntity</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildEntityLiveData">buildEntityLiveData</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildEntityScheduleData">buildEntityScheduleData</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildParkEntities">buildParkEntities</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildRestaurantEntities">buildRestaurantEntities</a></li><li data-type='method'><a href="TokyoDisneyResort.html#buildShowEntities">buildShowEntities</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchAllFacilitiesData">fetchAllFacilitiesData</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchCalendar">fetchCalendar</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchDeviceID">fetchDeviceID</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchFacilitiesData">fetchFacilitiesData</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchLatestVersion">fetchLatestVersion</a></li><li data-type='method'><a href="TokyoDisneyResort.html#fetchRestaurantOperatingHours">fetchRestaurantOperatingHours</a></li><li data-type='method'><a href="TokyoDisneyResort.html#getEntitiesOfType">getEntitiesOfType</a></li></ul></li><li><a href="UniversalOrlando_UniversalOrlando.html">UniversalOrlando</a></li><li><a href="UniversalResortBase_UniversalResortBase.html">UniversalResortBase</a></li><li><a href="UniversalStudios_UniversalStudios.html">UniversalStudios</a></li><li><a href="WaltDisneyWorldResort.html">WaltDisneyWorldResort</a></li><li><a href="module.exports.html">exports</a></li><li></li><li></li><li></li></ul><h3>Global</h3><ul><li><a href="global.html#HTTP">HTTP</a></li><li><a href="global.html#Sieve">Sieve</a></li><li><a href="global.html#_del">_del</a></li><li><a href="global.html#_get">_get</a></li><li><a href="global.html#_getKeys">_getKeys</a></li><li><a href="global.html#_reusePromise">_reusePromise</a></li><li><a href="global.html#_set">_set</a></li><li><a href="global.html#activeFunctions">activeFunctions</a></li><li><a href="global.html#addGlobalInjections">addGlobalInjections</a></li><li><a href="global.html#attractionType">attractionType</a></li><li><a href="global.html#blockOnPendingTransactions">blockOnPendingTransactions</a></li><li><a href="global.html#boardingGroupState">boardingGroupState</a></li><li><a href="global.html#createCacheInstance">createCacheInstance</a></li><li><a href="global.html#entityType">entityType</a></li><li><a href="global.html#extractName">extractName</a></li><li><a href="global.html#findActiveFunctionIndex">findActiveFunctionIndex</a></li><li><a href="global.html#generateRandomAndroidUseragent">generateRandomAndroidUseragent</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getCache">getCache</a></li><li><a href="global.html#getDatabase">getDatabase</a></li><li><a href="global.html#getEntityID">getEntityID</a></li><li><a href="global.html#getKeys">getKeys</a></li><li><a href="global.html#getLiveDataErrors">getLiveDataErrors</a></li><li><a href="global.html#getMethods">getMethods</a></li><li><a href="global.html#getValidTagObject">getValidTagObject</a></li><li><a href="global.html#injectBasicProxy">injectBasicProxy</a></li><li><a href="global.html#injectCrawlBase">injectCrawlBase</a></li><li><a href="global.html#injectScrapfly">injectScrapfly</a></li><li><a href="global.html#isSimpleTagType">isSimpleTagType</a></li><li><a href="global.html#isValidTag">isValidTag</a></li><li><a href="global.html#isValidTagType">isValidTagType</a></li><li><a href="global.html#metaCommands">metaCommands</a></li><li><a href="global.html#parseConfig">parseConfig</a></li><li><a href="global.html#queueType">queueType</a></li><li><a href="global.html#returnTimeState">returnTimeState</a></li><li><a href="global.html#reusePromise">reusePromise</a></li><li><a href="global.html#reusePromiseForever">reusePromiseForever</a></li><li><a href="global.html#riderHeightValidate">riderHeightValidate</a></li><li><a href="global.html#runTransaction">runTransaction</a></li><li><a href="global.html#scheduleType">scheduleType</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setOverrideFunction">setOverrideFunction</a></li><li><a href="global.html#simpleTags">simpleTags</a></li><li><a href="global.html#statusType">statusType</a></li><li><a href="global.html#tagType">tagType</a></li><li><a href="global.html#validateEntitySchedule">validateEntitySchedule</a></li><li><a href="global.html#validateObjectContainsOnlyGivenKeys">validateObjectContainsOnlyGivenKeys</a></li><li><a href="global.html#validators">validators</a></li><li><a href="global.html#wrap">wrap</a></li><li><a href="global.html#writeToHAR">writeToHAR</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">parks/te2/te2.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {URL} from 'url';
import moment from 'moment-timezone';

import Destination from '../destination.js';
import {attractionType, statusType, queueType, scheduleType, entityType} from '../parkTypes.js';

// Ride indicator labels used to identify attractions with wait times
const RIDE_INDICATOR_LABELS = new Set(['thrill level', 'rider height', 'ages']);

// Schedule types
const SCHEDULE_TYPE_PERFORMANCE = 'Performance Time';

// Schedule label identifiers
const PARK_SCHEDULE_LABELS = ['park', 'gate'];

/**
 * Base destination for TE2-powered parks.
 * Handles basic auth using the configured username/password.
 */
export class TE2Destination extends Destination {
  /**
   * Create a new TE2Destination object
   * @param {object} options Configuration options
   * @param {string} [options.timezone] Park timezone (default: Australia/Brisbane)
   * @param {string} [options.destinationId] Unique destination identifier
   * @param {string} [options.venueId] TE2 API venue ID
   * @param {string} [options.subdomain] TE2 API subdomain
   * @param {string} [options.apidomain] TE2 API domain
   * @param {string} [options.apiuser] TE2 API username
   * @param {string} [options.apipass] TE2 API password
   * @param {Array&lt;string>} [options.rideTypes] Categories to classify as rides
   * @param {Array&lt;string>} [options.diningTypes] Categories to classify as dining
   * @param {Array&lt;string>} [options.showTypes] Categories to classify as shows
   * @param {number} [options.eventScheduleDays] Days to fetch for event schedule (default: 14)
   */
  constructor(options = {}) {
    options.timezone = options.timezone || 'Australia/Brisbane';
    options.destinationId = options.destinationId || '';
    options.venueId = options.venueId || '';
    options.subdomain = options.subdomain || 'vrtp';
    options.apidomain = options.apidomain || 'te2.biz';
    options.apiuser = options.apiuser || '';
    options.apipass = options.apipass || '';
    options.rideTypes = options.rideTypes || ['Ride', 'Coasters', 'Family', 'ThrillRides', 'Kids', 'Rides &amp; Attractions'];
    options.diningTypes = options.diningTypes || ['Snacks', 'wpDining', 'Meals', 'Dining'];
    options.showTypes = options.showTypes || ['Shows', 'Show', 'Entertainment', 'Live Entertainment', 'Presentation'];
    options.eventScheduleDays = options.eventScheduleDays || 14;

    // allow configuring credentials via TE2_* env vars
    options.configPrefixes = ['TE2'].concat(options.configPrefixes || []);

    super(options);

    if (!this.config.destinationId) throw new Error('Missing destinationId');
    if (!this.config.venueId) throw new Error('Missing venueId');
    if (!this.config.subdomain) throw new Error('Missing subdomain');
    if (!this.config.apidomain) throw new Error('Missing apidomain');
    if (!this.config.apiuser) throw new Error('Missing apiuser');
    if (!this.config.apipass) throw new Error('Missing apipass');

    this.config.apiBase = this.config.apiBase || `https://${this.config.subdomain}.${this.config.apidomain}`;

    const baseURLHostname = new URL(this.config.apiBase).hostname;

    this.http.injectForDomain({
      hostname: baseURLHostname,
    }, async (method, url, data, options = {}) => {
      const requestUrl = new URL(url);

      options.headers = {
        ...(options.headers || {}),
        'Content-Type': 'application/json',
      };

      if (requestUrl.pathname.startsWith('/rest/')) {
        const credentials = Buffer.from(`${this.config.apiuser}:${this.config.apipass}`).toString('base64');
        options.headers.Authorization = `Basic ${credentials}`;
      }
    });
  }

  /**
   * Fetch current POI status data including wait times and operational status
   * @return {Promise&lt;object>} POI status data
   */
  async getPOIStatus() {
    '@cache|1';
    const resp = await this.http('GET', `${this.config.apiBase}/rest/venue/${this.config.venueId}/poi/all/status`);
    return resp?.body ?? resp;
  }

  /**
   * Fetch venue/destination metadata
   * @return {Promise&lt;object>} Destination data including name and location
   */
  async getDestinationData() {
    '@cache|1440';
    const resp = await this.http('GET', `${this.config.apiBase}/rest/venue/${this.config.venueId}`);
    return resp?.body ?? resp;
  }

  /**
   * Fetch all Points of Interest (attractions, dining, shows, etc.) for this venue
   * @return {Promise&lt;Array>} Array of POI objects
   */
  async getPOIData() {
    '@cache|1440';
    const resp = await this.http('GET', `${this.config.apiBase}/rest/venue/${this.config.venueId}/poi/all`);
    return resp?.body ?? resp;
  }

  /**
   * Fetch category definitions from the TE2 API
   * @return {Promise&lt;object>} Category data with POI associations
   * @private
   */
  async _fetchCategories() {
    '@cache|1440';
    const resp = await this.http('GET', `${this.config.apiBase}/rest/app/${this.config.venueId}/displayCategories`);
    return resp?.body ?? resp;
  }

  /**
   * Parse category data to find POI entities matching the given types
   * Recursively includes child categories based on parent relationships
   * @param {object} params Parameters
   * @param {Array&lt;string>} params.initialTypes Initial category types to search for
   * @return {Promise&lt;object>} Object containing matched types and entity IDs
   * @private
   */
  async _getParsedCategories({initialTypes}) {
    const types = Array.isArray(initialTypes) ? [...initialTypes] : [];
    const entities = [];

    const categoryData = await this._fetchCategories();
    if (!Array.isArray(categoryData?.categories)) {
      return {
        types,
        entities,
      };
    }

    categoryData.categories.forEach((cat) => {
      if (types.indexOf(cat.label) >= 0) {
        if (types.indexOf(cat.id) &lt; 0) {
          types.push(cat.id);
        }
        if (Array.isArray(cat.poi)) {
          entities.push(...cat.poi);
        }
      }
      if (cat.parent &amp;&amp; types.indexOf(cat.parent) >= 0) {
        if (types.indexOf(cat.id) &lt; 0) {
          types.push(cat.id);
        }
        if (Array.isArray(cat.poi)) {
          entities.push(...cat.poi);
        }
      }
    });

    return {
      types,
      entities: [...new Set(entities)],
    };
  }

  /**
   * Get parsed category data for attraction/ride types
   * @return {Promise&lt;object>} Object with types array and entities array
   */
  async getAttractionTypes() {
    return await this._getParsedCategories({
      initialTypes: this.config.rideTypes,
    });
  }

  /**
   * Get parsed category data for dining types
   * @return {Promise&lt;object>} Object with types array and entities array
   */
  async getDiningTypes() {
    return await this._getParsedCategories({
      initialTypes: this.config.diningTypes,
    });
  }

  /**
   * Get parsed category data for show/entertainment types
   * @return {Promise&lt;object>} Object with types array and entities array
   */
  async getShowTypes() {
    return await this._getParsedCategories({
      initialTypes: this.config.showTypes,
    });
  }

  /**
   * Build a base entity object from TE2 API data
   * Extracts common fields like name, ID, and location
   * @param {object} data Raw entity data from TE2 API
   * @return {object} Base entity object with standardized fields
   */
  buildBaseEntityObject(data) {
    const entity = super.buildBaseEntityObject(data);

    if (data) {
      entity.name = data.name || data.label;
      entity._id = data.id || undefined;

      if (data.location) {
        if (data.location.lon !== undefined &amp;&amp; data.location.lat !== undefined) {
          const lon = Number(data.location.lon);
          const lat = Number(data.location.lat);
          if (!Number.isNaN(lon) &amp;&amp; !Number.isNaN(lat)) {
            entity.location = {
              longitude: lon,
              latitude: lat,
            };
          }
        }
        if (data.location.center?.lon !== undefined &amp;&amp; data.location.center?.lat !== undefined) {
          const lon = Number(data.location.center.lon);
          const lat = Number(data.location.center.lat);
          if (!Number.isNaN(lon) &amp;&amp; !Number.isNaN(lat)) {
            entity.location = {
              longitude: lon,
              latitude: lat,
            };
          }
        }
      }
    }

    return entity;
  }

  /**
   * Build the destination entity representing this venue
   * @return {Promise&lt;object>} Destination entity object
   */
  async buildDestinationEntity() {
    const destinationData = await this.getDestinationData();
    const name = destinationData?.name || destinationData?.label || this.config.name || this.config.destinationId;
    const slug = (name || '').toLowerCase().replace(/[^a-z0-9]+/g, '').replace(/(^-|-$)/g, '') || this.config.destinationId;
    return {
      ...this.buildBaseEntityObject(destinationData),
      _id: `${this.config.destinationId}_destination`,
      slug,
      entityType: entityType.destination,
    };
  }

  /**
   * Build park entities for this destination
   * In TE2, the destination and park are typically the same venue
   * @return {Promise&lt;Array&lt;object>>} Array of park entity objects
   */
  async buildParkEntities() {
    const destinationData = await this.getDestinationData();
    const name = destinationData?.name || destinationData?.label || this.config.name || this.config.destinationId;
    const slug = (name || '').toLowerCase().replace(/[^a-z0-9]+/g, '').replace(/(^-|-$)/g, '') || this.config.destinationId;
    return [
      {
        ...this.buildBaseEntityObject(destinationData),
        _id: this.config.destinationId,
        _destinationId: `${this.config.destinationId}_destination`,
        _parentId: `${this.config.destinationId}_destination`,
        slug: `${slug || this.config.destinationId}park`,
        entityType: entityType.park,
      },
    ];
  }

  /**
   * Filter POI data to get entities matching specified types/IDs
   * Supports custom filtering via includeFn callback
   * @param {object} categoryData Object containing types and entities arrays
   * @param {Array&lt;string>} categoryData.types Category type IDs to match
   * @param {Array&lt;string>} categoryData.entities Entity IDs to match
   * @param {object} data Additional data to merge into each entity
   * @param {object} options Options object
   * @param {Function} [options.includeFn] Custom filter function for additional inclusion logic
   * @return {Promise&lt;Array&lt;object>>} Array of filtered entity objects
   * @private
   */
  async _getFilteredEntities({types, entities}, data, {includeFn} = {}) {
    const poi = await this.getPOIData();
    if (!Array.isArray(poi)) {
      return [];
    }

    const typeSet = new Set(Array.isArray(types) ? types : []);
    const entitySet = new Set(Array.isArray(entities) ? entities : []);
    const seenIds = new Set();

    return poi.filter((entry) => {
      if (!entry?.id) return false;

      if (seenIds.has(entry.id)) {
        return false;
      }

      const matchesCategory = typeSet.has(entry.type) || entitySet.has(entry.id);
      const matchesFallback = typeof includeFn === 'function' ? includeFn(entry) : false;

      if (!(matchesCategory || matchesFallback)) {
        return false;
      }

      seenIds.add(entry.id);
      return true;
    }).map((entry) => {
      return {
        ...this.buildBaseEntityObject(entry),
        _destinationId: `${this.config.destinationId}_destination`,
        _parentId: this.config.destinationId,
        _parkId: this.config.destinationId,
        ...data,
      };
    });
  }

  /**
   * Build attraction entities for this destination
   * Includes rides identified by category or by presence of wait time/ride indicator tags
   * @return {Promise&lt;Array&lt;object>>} Array of attraction entity objects
   */
  async buildAttractionEntities() {
    return await this._getFilteredEntities(
      await this.getAttractionTypes(),
      {
        entityType: entityType.attraction,
        attractionType: attractionType.ride,
      },
      {
        includeFn: (entry) => {
          // Include entries with status data that have ride indicator tags
          const status = entry?.status;
          if (!status || (status.waitTime === undefined &amp;&amp; status.operationalStatus === undefined)) {
            return false;
          }

          const tags = Array.isArray(entry?.tags) ? entry.tags : [];
          return tags.some((tag) => {
            const label = (tag?.label || '').toLowerCase();
            return RIDE_INDICATOR_LABELS.has(label);
          });
        },
      },
    );
  }

  /**
   * Build restaurant/dining entities for this destination
   * @return {Promise&lt;Array&lt;object>>} Array of restaurant entity objects
   */
  async buildRestaurantEntities() {
    return await this._getFilteredEntities(
      await this.getDiningTypes(),
      {
        entityType: entityType.restaurant,
      },
    );
  }

  /**
   * Build a POI lookup map from POI data array
   * @param {Array} poiData - Array of POI data objects
   * @return {Map} Map of POI ID to POI object
   * @private
   */
  _buildPOIMap(poiData) {
    const poiMap = new Map();
    if (Array.isArray(poiData)) {
      poiData.forEach((poi) => {
        if (poi?.id) {
          poiMap.set(poi.id, poi);
        }
      });
    }
    return poiMap;
  }

  /**
   * Find location data from associated POIs or fallback sources
   * @param {Array} associatedPois - Array of associated POI objects
   * @param {object} basePoi - Base POI object to check for location
   * @return {object|null} Location object with latitude/longitude or null
   * @private
   */
  async _findLocationForShowEntity(associatedPois, basePoi) {
    // First try to find location from associated POIs
    const poiWithLocation = associatedPois.find((poi) => poi?.location?.latitude &amp;&amp; poi?.location?.longitude);
    if (poiWithLocation) {
      return {
        latitude: Number(poiWithLocation.location.latitude),
        longitude: Number(poiWithLocation.location.longitude),
      };
    }

    // Try base POI location
    if (basePoi?.location) {
      return {...basePoi.location};
    }

    // Fallback to config location
    if (this.config?.location) {
      return {...this.config.location};
    }

    // last resort, use destination location
    const destinationData = await this.getDestinationData();
    if (destinationData?.location?.center) {
      const lon = Number(destinationData.location.center.lon);
      const lat = Number(destinationData.location.center.lat);
      if (!Number.isNaN(lon) &amp;&amp; !Number.isNaN(lat)) {
        return {
          latitude: lat,
          longitude: lon,
        };
      }
    }

    return null;
  }

  /**
   * Build a show entity from event calendar data
   * @param {object} event - Event data from calendar
   * @param {Map} poiMap - Map of POI IDs to POI objects
   * @return {object} Show entity object
   * @private
   */
  async _buildShowEntityFromEvent(event, poiMap) {
    const associatedPois = Array.isArray(event.associatedPois) ? event.associatedPois : [];

    // Find base POI from associated POIs
    let basePoi = null;
    for (const assoc of associatedPois) {
      if (assoc?.id &amp;&amp; poiMap.has(assoc.id)) {
        basePoi = poiMap.get(assoc.id);
        break;
      }
    }

    // Build base entity from POI or event data
    const entityBase = basePoi
      ? this.buildBaseEntityObject(basePoi)
      : this.buildBaseEntityObject({id: event.id, name: event.title});

    const entity = {
      ...entityBase,
      _id: event.id,
      _destinationId: `${this.config.destinationId}_destination`,
      _parentId: this.config.destinationId,
      _parkId: this.config.destinationId,
      entityType: entityType.show,
      name: event.title || entityBase?.name || event.id,
    };

    // Add description if available
    if (event.description) {
      entity.description = event.description;
    }

    // Find and set location if not already set
    if (!entity.location) {
      const location = await this._findLocationForShowEntity(associatedPois, basePoi);
      if (location) {
        entity.location = location;
      }
    }

    return entity;
  }

  /**
   * Build show/entertainment entities for this destination
   * Combines show entities from categories and event calendar data
   * @return {Promise&lt;Array&lt;object>>} Array of show entity objects
   */
  async buildShowEntities() {
    // Get show entities from filtered show types
    const showEntities = await this._getFilteredEntities(
      await this.getShowTypes(),
      {
        entityType: entityType.show,
      },
    );

    const existingIds = new Set(showEntities.map((ent) => ent?._id).filter((id) => !!id));

    // Fetch event calendar data and add any missing show entities
    const {events, showtimesByEvent} = await this._getEventCalendarData();
    if (events.length > 0) {
      const poiData = await this.getPOIData();
      const poiMap = this._buildPOIMap(poiData);

      for (const event of events) {
        if (!event?.id) return;
        if (existingIds.has(event.id)) return;

        const entity = await this._buildShowEntityFromEvent(event, poiMap);
        showEntities.push(entity);
        existingIds.add(entity._id);
      }
    }

    return showEntities;
  }

  /**
   * Fetch venue operating hours schedule data
   * @param {object} options Options object
   * @param {number} [options.days=120] Number of days to fetch schedule for
   * @return {Promise&lt;object>} Schedule data with daily operating hours
   * @private
   */
  async _fetchScheduleData({days = 120} = {}) {
    '@cache|1440';
    const resp = await this.http('GET', `${this.config.apiBase}/v2/venues/${this.config.venueId}/venue-hours?days=${days}`);
    return resp.body;
  }

  /**
   * Fetch event calendar data including shows and entertainment schedules
   * @param {object} options Options object
   * @param {number} [options.days] Number of days to fetch (uses config.eventScheduleDays if not specified)
   * @return {Promise&lt;object>} Event calendar data with events and schedules
   */
  async fetchEventCalendar({days} = {}) {
    '@cache|30';
    const duration = Number.isFinite(days) ? days : this.config.eventScheduleDays;
    const resp = await this.http('GET', `${this.config.apiBase}/v2/venues/${this.config.venueId}/calendars/events?days=${duration}`);
    return resp?.body ?? resp;
  }

  /**
   * Get parsed event calendar data with showtimes organized by event
   * Filters out past events and creates showtime objects
   * @return {Promise&lt;object>} Object containing events, eventsById map, and showtimesByEvent map
   * @private
   */
  async _getEventCalendarData() {
    try {
      const calendar = await this.fetchEventCalendar({});
      const events = Array.isArray(calendar?.events) ? calendar.events : [];
      const schedules = Array.isArray(calendar?.schedules) ? calendar.schedules : [];
      if (!events.length || !schedules.length) {
        return {
          events: [],
          eventsById: new Map(),
          showtimesByEvent: new Map(),
        };
      }

      const eventsById = new Map();
      events.forEach((event) => {
        if (event?.id) {
          eventsById.set(event.id, event);
        }
      });

      const nowMs = Date.now();
      const showtimesByEvent = new Map();

      schedules.forEach((slot) => {
        const event = eventsById.get(slot?.eventId);
        if (!event) return;

        const start = slot?.start;
        if (!start) return;

        const startMs = Date.parse(start);
        if (!Number.isFinite(startMs) || startMs &lt; nowMs) return;

        const end = slot?.end;
        const endMs = end ? Date.parse(end) : Number.NaN;
        const showtime = {
          type: SCHEDULE_TYPE_PERFORMANCE,
          startTime: start,
          endTime: Number.isFinite(endMs) ? end : start,
        };

        if (!showtimesByEvent.has(event.id)) {
          showtimesByEvent.set(event.id, new Map());
        }

        const eventMap = showtimesByEvent.get(event.id);
        const key = `${showtime.startTime}|${showtime.endTime}`;
        if (!eventMap.has(key)) {
          eventMap.set(key, showtime);
        }
      });

      const normalizedShowtimes = new Map();
      showtimesByEvent.forEach((eventMap, eventId) => {
        const items = Array.from(eventMap.values()).sort((a, b) => a.startTime.localeCompare(b.startTime));
        if (items.length > 0) {
          normalizedShowtimes.set(eventId, items);
        }
      });

      return {
        events,
        eventsById,
        showtimesByEvent: normalizedShowtimes,
      };
    } catch (err) {
      this.log(`Failed to fetch TE2 event data: ${err?.message || err}`);
      return {
        events: [],
        eventsById: new Map(),
        showtimesByEvent: new Map(),
      };
    }
  }

  async buildEntityScheduleData() {
    const scheduleData = await this._fetchScheduleData();
    if (!Array.isArray(scheduleData?.days)) {
      return [];
    }

    const scheduleEntries = [];
    scheduleData.days.forEach((day) => {
      (day.hours || []).forEach((hours) => {
        if (day.label !== 'Park' &amp;&amp; hours.status === 'CLOSED') return;

        const start = hours?.schedule?.start;
        const end = hours?.schedule?.end;
        if (!start || !end) return;

        const startMoment = moment(start).tz(this.config.timezone);
        const endMoment = moment(end).tz(this.config.timezone);
        if (!startMoment.isValid() || !endMoment.isValid()) return;

        const label = typeof hours.label === 'string' ? hours.label.trim() : '';
        const normalizedLabel = label.toLowerCase();

        // Determine if this is a park operating schedule or informational schedule
        let scheduleTypeValue = scheduleType.informational;
        if (PARK_SCHEDULE_LABELS.includes(normalizedLabel)) {
          scheduleTypeValue = scheduleType.operating;
        }

        scheduleEntries.push({
          date: startMoment.format('YYYY-MM-DD'),
          type: scheduleTypeValue,
          description: normalizedLabel === 'park' ? undefined : label || undefined,
          openingTime: startMoment.format(),
          closingTime: endMoment.format(),
        });
      });
    });

    if (scheduleEntries.length === 0) {
      return [];
    }

    scheduleEntries.sort((a, b) => {
      const dateCompare = a.date.localeCompare(b.date);
      if (dateCompare !== 0) {
        return dateCompare;
      }
      return a.openingTime.localeCompare(b.openingTime);
    });

    return [
      {
        _id: this.config.destinationId,
        schedule: scheduleEntries,
      },
    ];
  }

  async buildEntityLiveData() {
    const liveDataMap = new Map();

    const statusData = await this.getPOIStatus();
    if (Array.isArray(statusData)) {
      statusData.forEach((entry) => {
        if (!entry?.status || !entry.id) return;
        if (entry.id.includes('_STANDING_OFFER_BEACON')) return;

        const liveData = liveDataMap.get(entry.id) || {_id: entry.id};

        if (entry.status.waitTime !== undefined) {
          const rawWait = Number(entry.status.waitTime);
          const sanitizedWait = Number.isFinite(rawWait) ? Math.max(0, Math.round(rawWait)) : null;

          liveData.queue = {
            [queueType.standBy]: {
              waitTime: sanitizedWait,
            },
          };
        }

        liveData.status = entry.status.isOpen ? statusType.operating : statusType.closed;

        liveDataMap.set(entry.id, liveData);
      });
    }

    const {eventsById, showtimesByEvent} = await this._getEventCalendarData();
    const now = this.getTimeNowMoment();
    const todayKey = now.tz(this.config.timezone).format('YYYY-MM-DD');

    const filterShowtimesForToday = (showtimes) => {
      return showtimes.filter((slot) => {
        if (!slot?.startTime) return false;
        const startMoment = moment.tz(slot.startTime, this.config.timezone);
        if (!startMoment.isValid()) return false;
        if (startMoment.isBefore(now)) return false;
        return startMoment.format('YYYY-MM-DD') === todayKey;
      });
    };

    showtimesByEvent.forEach((showtimes, eventId) => {
      if (!showtimes.length) return;
      const todaysShowtimes = filterShowtimesForToday(showtimes);
      if (!todaysShowtimes.length) return;

      const liveData = liveDataMap.get(eventId) || {_id: eventId};
      liveData.showtimes = todaysShowtimes;
      liveData.status = statusType.operating;

      liveDataMap.set(eventId, liveData);
    });

    return Array.from(liveDataMap.values());
  }
}

export class SeaWorldGoldCoast extends TE2Destination {
  constructor(options = {}) {
    options.name = options.name || 'Sea World Gold Coast';
    options.destinationId = options.destinationId || 'vrtp_sw_te2';
    options.venueId = options.venueId || 'VRTP_SW';
    super(options);
  }
}

export class WarnerBrosMovieWorld extends TE2Destination {
  constructor(options = {}) {
    options.name = options.name || 'Warner Bros. Movie World';
    options.destinationId = options.destinationId || 'vrtp_mw_te2';
    options.venueId = options.venueId || 'VRTP_MW';
    super(options);
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Tue Jan 06 2026 15:37:27 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
